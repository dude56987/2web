% 2WEB()

NAME
====

2web - CLI for administration of 2web server

SYNOPSIS
========

`2web [ -a ] [ --all ] [ all ]`

DESCRIPTION
===========

Generate a website for use on a LAN(Local Area Network) as a http/https accessible multimedia library. 2web allows you to host multimedia content as a KODI compatible http/https media server using apache2 php and minimal javascript. This software is designed to run on the latest version of the raspberry pi (4 2gig). Currently supporting a library size of ~20k shows, ~20k movies, ~20k books, ~50 weather stations and ~5k channels/radio stations on a raspberry pi 4. This software is also designed to be compatible with any Ubuntu or Debian based system. So if you have more than a raspberry pi applications are multi threaded to be able to completely utilize any amount of hardware.

This is the 2web administration and update program. With this interface you can manage all 2web components simultaneously.

OPTIONS
=======

`-h, --help`

:   Show the help message and exit

`-a, --all, all`

:   Run all modules and check for updated settings and content in libaries.

`-a, --all, all`

:   Run all 2web components

`-p, --parallel, parallel`

:   Run all 2web compentents in parallel.(!EXPERMIMENTAL!)

`-I, --iptv, iptv`

:   Update iptv2web

`-N, --nfo, nfo`

:   Update nfo2web

`-C, --comic, comic`

:   Update comic2web

`-rc, --reboot-check, rebootcheck`

:   Check if it is the reboot hour and reboot if it is.

`-cc, --clean-cache, cleancache`

:   Cleanup the web caches based on web cache time setting

`-V, --verify, verify`

:   Check all database entries to remove false entries.

`-L, --unlock, unlock`

:   Remove lockfiles leftover from system crashes or reboots.

`-U, --upgrade, upgrade`

:   Upgrade libaries used by modules in the background for operation. This can fix issues with backend resolution issues. Upgrade youtube-dl, gallery-dl, hls.js

`-u, --update, update`

:   Update all 2web components.

`-r, --reset, reset`

:   Reset the state of all 2web components without deleting downloaded metadata.

`-R, --rescan, rescan`

:   Force new salts for all md5sums and rescan all media from all modules into the server. This will remove any .nomedia locks preventing kodi clients from scanning old media on the network.

`-w, --webgen, webgen`

:   Generate webpage parts of all 2web components.

`-l, --libary, libary`

:   Download the latest version of the hls.js library for use.

`--screenshots`

:   Take screenshots of all the webpages and generate a comic book in the generated comics directory. /var/cache/2web/generated/comics/

`--fast-client`

:   Enable the fast client on the display of this server. This will setup a custom lightweight desktop that will auto login. The desktop will launch VLC to play videos and can be controlled with the client remote webpage.

`--kodi-client`

:   Enable the kodi login session and automaticaly login to the kiosk user. The sources for kodi will all be set to the local server and the remote control will be auto setup on the local server.

`--browser-client`

:   Setup a auto login browser kiosk on the local server display. Load up the client page from the local server automatically.

### Logs

If you want simple stats you can enable the graph2web module to add all munin charts generated by the system to the 2web interface.

By default logs are disabled. This is because the log files can quickly fill even a large disk. Apache logs can be enabled in the apache configs.

	/etc/apache2/sites-available/0-2web-website.conf
	/etc/apache2/sites-available/0-2web-website-SSL.conf

Uncomment the "CustomLog" line pointing to the default system log directory. Below is how the lines should look if you want apache access logging.

	CustomLog ${APACHE_LOG_DIR}/2web-access.log combined
	#CustomLog /dev/null combined

### Apache Settings

2web takes over port 80 and 443 by default but can be changed in

	/etc/apache2/sites-available/0-2web-website.conf
	/etc/apache2/sites-available/0-2web-website-SSL.conf

### Updates

Updates to modules are scheduled via cron and can be only edited at

	/etc/cron.d/2web

by a system administrator. If you want to force a update immediately you must have Command line access to the system and use the update commands in the below CLI section.

## CLI

The CLI can be used by administrators on the server to update various content stacks on the server.

To build the backbone of the webserver run

	2web

This will enable the server and place all base webpages to allow access to the web interface.

The master interface can update all modules in one command.

	2web all

Or to max out the speed

	2web --parallel

Each individual web section has its own CLI interface for running manual generation or a clean reset of a individual module. Resets may be required for missing or removed content. Sometimes after updates the layout will change and the remote metadata will duplicate this can be solved by a section reset. In the worst case if functionality is broken you can run

	2web nuke

and

	2web all

to delete all metadata and website data and rebuild the entire website.

To update each section use the following

	nfo2web

	iptv2web

	comic2web

	weather2web

	ytdl2nfo

	music2web

	graph2web

Resets can be done with the master interface by

	2web reset

and individually by

	nfo2web reset

	iptv2web reset

	comic2web reset

	weather2web reset

	ytdl2nfo reset

	music2web reset

	graph2web reset

Finally you can delete the entire website with

	2web nuke

or individually

	nfo2web nuke

	iptv2web nuke

	comic2web nuke

	weather2web nuke

	ytdl2nfo nuke

	music2web nuke

	graph2web nuke

kodi2web is a diffrent module, it is called inside individual modules to trigger updates within connected remote kodi clients. This to can be triggered manually by an administrator with

	kodi2web

Understanding /etc/2web/
===================

Contains all settings related to 2web and 2web modules. Sever only accessible config files exist and web interface editable example.d/ files exist for that use case. The file ownership of the example.d/ files can be set to root and not www-data to block the web interface out.


- Directories
  - /etc/2web/comics/
    - This is where comic2web settings are stored
  - /etc/2web/nfo/
    - This is where nfo2web settings are stored
  - /etc/2web/ytdl/
    - This is where ytdl2nfo settings are stored
  - /etc/2web/iptv/
    - This is where iptv2web settings are stored
  - /etc/2web/themes/
    - This is the location of all default and user installed CSS themes.
    - Any files found here with a .css extension will be copied into the theme list in the web interface.
    - Custom themes can be created with a single .css file and added in this directory.
  - /etc/2web/users/
    - This is where the administrator credentials are kept for users

- Files
  - /etc/2web/theme.cfg
    - This is the name of the theme file found in /etc/2web/themes/ that has been chosen as the website CSS theme.
  - /etc/2web/fortuneStatus.cfg
    - This is a binary file that if it exists the '/usr/bin/fortune' will be displayed on the homepage of the website.
  - /etc/2web/certInfo.cnf
    - This is the cert info template used to generate the ssl certificate. Look more into openssl key generation.
  - /etc/2web/cacheNewEpisodes.cfg
    - This will cause the new episodes to be cached in the background using a single file queue. Active caching still will work.
  - /etc/2web/weatherLocation.cfg
    - This determines the location used for the weather on the homepage.

### Performance Enhancements

#### RAMDISKS

A ramdisk can be used on the entire website to host the entire generated site in ram, media files will still be loaded from disk. If you load the entire website into ram it will need to be regenerated every time the server is rebooted. In this case if the system is fast enough you can edit /etc/cron.d/2web by adding --parallel to make site components run parallel processing. However some individual directories in the site can be safely symlinked to a ramdisk with little issue.

- /var/cache/2web/web/web_cache/
  - This directory contains php generated files for caching web requests
- /var/cache/2web/web/RESOLVER-CACHE/
  - This directory contains the temporary media files cached for playback from external website videos.
- /var/cache/2web/web/m3u_cache/
  - Contains the temporary .m3u playlists generated on web request.

### Module Components

| module			| man page | Web Settings | /etc/2web/ |
|-------------|----------|--------------|------------|
| 2web				| ✔️				 | ✔️						| ✔️					 |
| nfo2web			| ✔️				 | ✔️						| ✔️					 |
| comic2web		| ✔️				 | ✔️						| ✔️					 |
| iptv2web		| ✔️				 | ✔️						| ✔️					 |
| wiki2web		| ❌			 | ❌						| ✔️					 |
| weather2web | ✔️				 | ✔️						| ✔️					 |
| graph2web		| ✔️				 | 〽️						| ✔️					 |
| kodi2web		| ❌			 | ❌						| ✔️					 |
| ytdl2nfo		| ✔️				 | ✔️						| ✔️					 |

### Resolver Components

| resolvers			| Working |  Web Settings  | /etc/2web/ |
|---------------|---------|----------------|------------|
| ytdl-resolver	| ✔️				| ✔️							 | ✔️					|
| m3u-gen				| ✔️				| ❌						 | ❌					|
| iptv-resolver	| ✔️				| ❌						 | ❌					|
| search				| ✔️				| ❌						 | ❌					|
| transcode 		| ✔️				| ✔️							 | ❌					|
| zip-gen 			| ✔️				| ❌						 | ❌					|
